# **Streaming Yahoo Finance Data with AWS Lambda**
- [**Streaming Yahoo Finance Data with AWS Lambda**](#streaming-yahoo-finance-data-with-aws-lambda)
    - [Background](#background)
    - [Setting up the Project](#setting-up-the-project)
      - [Part I: Design and Inital Setup](#part-i-design-and-inital-setup)
      - [Part II: Data Transformation](#part-ii-data-transformation)
      - [Part III: Data Analysis](#part-iii-data-analysis)
 
### Background
This project involves setting up a few AWS technologies to generate near real time finance data records for interactive querying. This will allow us to capture and analyze data that is being constantly generated in or near to real time. We will utilize the [yfinance](https://github.com/ranaroussi/yfinance) module that provides a suitable and effective way to download and view historical market data from [Yahoo! finance](https://finance.yahoo.com/).
  We will be taking a look at the following stocks: 
 - Facebook (FB), Shopify (SHOP), Beyond Meat (BYND), Netflix (NFLX), Pinterest (PINS)
 - Square (SQ), The Trade Desk (TTD), Okta (OKTA), Snap (SNAP), Datadog (DDOG)
  
  Our aim is to leverage an AWS Lamda function as well as AWS Kinesis, S3, Glue and Athena to capture data over a specific time period and run a few queries as well as provide some analsyis and visualizations.


 ### Setting up the Project

 #### Part I: Design and Inital Setup 
1. The following is an overview of the project infrastructure
      
![](https://github.com/OjeWilliams/Streaming-Yahoo-Finance-Data-with-AWS-Lambda/blob/main/images/workflow.png)
<br />

1. Configure an Amazon Kinesis Stream
   - Ensure that you give a suitable name and then click into it and choose the destination as a one of your S3 buckets.
   - Ensure that the buffer size is set to **1** and the buffer interval set to **60**.

Below is an example of my Kinesis stream

![](https://github.com/OjeWilliams/Streaming-Yahoo-Finance-Data-with-AWS-Lambda/blob/main/images/kinesis-config.png)

<br />
<br />

3. Provision a Simple Lambda Service
   - From the AWS console search for "Lamda" and then select "Create a function"
   - Select " Author from scratch" and ensure that you give in an appropriate name and select **Python 3.8** for the Runtime. 
   - Next click on "Add Trigger", select **API Gateway**. Ensure that on the configuration page **Rest API** is selected and security is set to **Open**.
    <br />

4. Attach IAM Roles to LAmda function
   - Enure that you go to Iam Roles and select the lambda function thgat was created .
   - Select **Attach policies** and ensure you add 
     - AmazonKinesisFullAccess
     - AmazonKinesisFirehouseFullAccess
     - KinesisFirehoseServicePolicy....
   <br />

5. Configure AWS Glue and AWS Athena
   - Confiure Athena to store your queries results inside a folder in your created S3 bucket.
   - Configure Glue choosing your S3 bucket as your data store and create an IAM ROLE to ensure that Athena, Glue and S3 can interact.
   - Add a database and under grouping and select **create a single schema for each S3 path** Is selected for Grouping behavior for S3 data.
  <br />
 

#### Part II: Data Transformation
In this section we have to develop a lambda function that utilizes the [yfinance module](https://github.com/ranaroussi/yfinance) to grab the stock information of the ten companies listed above. Speciically we want one full day's worth of the High and Low prices and this information should be collected at five minute intervals. Each singular record you attain should be a JSON object with the following setup

![](https://github.com/OjeWilliams/Streaming-Yahoo-Finance-Data-with-AWS-Lambda/blob/main/images/structure.png)

<br />
<br />

#### Part III: Data Analysis
Once you have collected your data for the stocks, provided everything was properly set up and connected, you can now use AWS Athena to run queries on your data. For this project a query was created to return the highest stock price for each company for every hour of the day. A csv should be generated which has the following look:


<p align="center">
  <img width="460" height="300" src="https://github.com/OjeWilliams/Streaming-Yahoo-Finance-Data-with-AWS-Lambda/blob/main/images/csv.png">
</p>

I pulled the csv generated by the query into a Jupyter Notebook for further analysis. One of the produced plots of this analysis can be seen below

![](https://github.com/OjeWilliams/Streaming-Yahoo-Finance-Data-with-AWS-Lambda/blob/main/images/flux.png)
